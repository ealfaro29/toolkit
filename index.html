<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Creative Toolkit</title>
  <style>
    :root {
      --accent-color: #4f46e5;
      --accent-color-tint: #c7d2fe;
      --color-text-primary-light: #1C1C1E; --color-text-secondary-light: #3A3A3C;
      --color-surface-light: #F5F5F7; --color-background-light: #FFFFFF;
      --color-divider-light: #EAEAEA; --color-text-primary-dark: #EAEAEB;
      --color-text-secondary-dark: #9A9A9E; --color-surface-dark: #121212;
      --color-background-dark: #1E1E1E; --color-divider-dark: #3A3A3C;
      --color-accent-text: #FFFFFF; --font-family-sans: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      --font-size-h1: 20px; --font-size-body: 14px; --font-size-caption: 12px;
      --font-weight-emphasis: 600; --font-weight-medium: 500;
      --space-2: 8px; --space-3: 12px; --space-4: 16px; --space-5: 24px;
      --radius-sm: 6px; --radius-md: 8px; --radius-xl: 16px;
      --shadow-raised-2: 0 4px 12px rgba(0,0,0,0.06);
      --shadow-floating-3: 0 8px 20px rgba(0,0,0,0.12);
      --duration-standard: 200ms;
    }
    html[data-theme="light"] { --ink: var(--color-text-primary-light); --muted: var(--color-text-secondary-light); --surface: var(--color-surface-light); --surface-alt: var(--color-background-light); --border-color: var(--color-divider-light); --panel-shadow: var(--shadow-raised-2); color-scheme: light; }
    html[data-theme="dark"] { --ink: var(--color-text-primary-dark); --muted: var(--color-text-secondary-dark); --surface: var(--color-surface-dark); --surface-alt: var(--color-background-dark); --border-color: var(--color-divider-dark); --panel-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); color-scheme: dark; }
    html { box-sizing: border-box; } *, *:before, *:after { box-sizing: inherit; }
    body { margin: 0; color: var(--ink); background-color: var(--surface); font: var(--font-size-body)/1.5 var(--font-family-sans); padding: 25px; }

    .container { max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; gap: 25px; }
    .panel { background: var(--surface-alt); border: 1px solid var(--border-color); border-radius: var(--radius-xl); box-shadow: var(--panel-shadow); }
    header.panel { height: 65px; display: flex; align-items: center; gap: var(--space-3); padding: 0 var(--space-4); }
    header h1 { font-size: var(--font-size-h1); font-weight: var(--font-weight-emphasis); margin: 0; }
    header .sub { color: var(--muted); }
    .theme-switcher { margin-left: auto; }
    #theme-toggle { width: 36px; height: 36px; padding: 0; border-radius: 50%; background-color: var(--surface); color: var(--ink); border: 1px solid var(--border-color); font-size: 18px; display: grid; place-items: center; cursor: pointer; transition: all var(--duration-standard) ease; }
    #theme-toggle:hover { background-color: var(--surface-alt); }

    .app-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
    .app-card { text-decoration: none; color: var(--ink); background: var(--surface-alt); border: 1px solid var(--border-color); border-radius: var(--radius-xl); box-shadow: var(--panel-shadow); padding: var(--space-5); display: flex; flex-direction: column; gap: var(--space-3); transition: transform var(--duration-standard) ease, box-shadow var(--duration-standard) ease; border-top: 4px solid var(--card-accent-color); cursor: grab; }
    .app-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-floating-3); }
    .app-card.dragging { opacity: 0.5; cursor: grabbing; }
    .app-card-icon { width: 48px; height: 48px; display: grid; place-items: center; border-radius: var(--radius-md); background-color: var(--card-icon-bg-color-transparent); color: var(--color-accent-text, #FFF); font-size: 28px; }
    .app-card-title { font-size: 18px; font-weight: var(--font-weight-emphasis); margin: 0; }
    .app-card-description { margin: 0; color: var(--muted); line-height: 1.6; }
    
    /* Easter Egg Styles */
    .kickass-target { transition: opacity 0.2s, transform 0.2s; display: inline-block; }
    .kickass-destroyed { opacity: 0; transform: scale(0.5); }
    .kickass-card-hittable { box-shadow: 0 0 15px var(--accent-color) !important; border-color: var(--accent-color) !important; }

    /* === 1. INICIA CSS PARA MODAL Y FOOTER === */
    
    /* Nuevo Footer Minimalista */
    .site-footer-minimal {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      padding: var(--space-4);
      /* No background, no border, no shadow */
    }

    /* Estilo de bot√≥n/enlace Minimalista */
    .minimal-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: transparent;
      border: none;
      border-radius: var(--radius-md); /* Suave para hover */
      color: var(--muted); /* Sutil */
      text-decoration: none;
      font: var(--font-size-body)/1.5 var(--font-family-sans);
      font-weight: 500;
      transition: all var(--duration-standard) ease;
      cursor: pointer;
    }
    .minimal-btn:hover {
      background-color: var(--surface-alt); /* Fondo sutil en hover */
      color: var(--ink);
    }
    .minimal-btn svg {
      width: 16px;
      height: 16px;
      stroke: currentColor;
    }
    .minimal-btn img {
      height: 20px; /* Altura para la imagen del contador */
      vertical-align: middle;
      opacity: 0.7;
    }
    .minimal-btn:hover img {
      opacity: 1;
    }

    /* Overlay del Popup */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .popup-overlay.show {
      display: flex;
    }

    /* Contenido del Modal de Feedback */
    .feedback-modal-content {
      background: var(--surface-alt);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-floating-3);
      z-index: 2001;
      width: 500px;
      max-width: 90vw;
      max-height: 90vh;
      border: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .feedback-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-color);
    }
    .feedback-header h3 {
      margin: 0;
      font-size: var(--font-size-h1);
      font-weight: var(--font-weight-emphasis);
    }
    #feedback-close-btn {
      background: none;
      border: none;
      font-size: 24px;
      line-height: 1;
      padding: 0;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    #feedback-close-btn:hover {
      background-color: var(--surface);
      color: var(--ink);
    }

    /* Formulario */
    #feedback-form {
      padding: var(--space-5);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }
    .form-section {
      display: none; /* Oculto por defecto */
      flex-direction: column;
      gap: var(--space-4);
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }
    .form-group label {
      font-weight: var(--font-weight-medium);
    }
    .form-control, .select-wrapper select, textarea {
      width: 100%;
      box-sizing: border-box;
      background: var(--surface);
      color: var(--ink);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      padding: 8px 12px;
      resize: vertical;
      min-height: 40px;
      font: var(--font-size-body)/1.5 var(--font-family-sans);
    }
    textarea.form-control {
      min-height: 80px;
    }
    .select-wrapper {
      position: relative;
    }
    .select-wrapper select {
      -webkit-appearance: none;
      appearance: none;
      padding-right: 32px;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      cursor: pointer;
      font-weight: var(--font-weight-emphasis);
      font-size: 14px;
      border-radius: var(--radius-md);
      height: 40px;
      padding: 0 var(--space-4);
      border: 1px solid transparent;
      transition: all var(--duration-standard) ease;
    }
    .btn-primary {
      background-color: var(--accent-color);
      color: var(--color-accent-text);
    }
    .btn:focus-visible, input:focus-visible, select:focus-visible, button:focus-visible, textarea:focus-visible { 
      outline: 2px solid var(--accent-color); 
      outline-offset: 2px; 
    }
    .btn:disabled {
      background-color: var(--surface);
      color: var(--muted);
      cursor: not-allowed;
    }
    
    /* Estilos para el 5-Star Rating */
    .star-rating {
      display: flex;
      flex-direction: row-reverse;
      justify-content: flex-end;
      gap: 4px;
    }
    .star-rating input[type="radio"] {
      display: none;
    }
    .star-rating label {
      font-size: 28px;
      color: var(--muted);
      cursor: pointer;
      transition: color 0.2s ease;
    }
    .star-rating input[type="radio"]:checked ~ label,
    .star-rating label:hover,
    .star-rating label:hover ~ label {
      color: #f59e0b; /* Naranja/Amarillo para estrella */
    }
    
    /* Estilos para el estado del formulario */
    #form-status {
      padding: var(--space-3);
      border-radius: var(--radius-sm);
      text-align: center;
      font-weight: var(--font-weight-medium);
      display: none;
    }
    #form-status.success {
      background-color: var(--accent-color-tint);
      color: var(--accent-color);
    }
    #form-status.error {
      background-color: #fecaca;
      color: #dc2626;
    }
    #form-status.sending {
      background-color: var(--surface);
      color: var(--muted);
    }
    /* === FIN CSS PARA MODAL Y FOOTER === */
  </style>
</head>
<body>
  <div class="container">
    <header class="panel">
      <h1>Creative Toolkit</h1>
      <div class="sub">A universe of mini-apps.</div>
      <div class="theme-switcher">
        <button id="theme-toggle" title="Change theme"></button>
      </div>
    </header>

    <main>
      <div class="app-grid" id="app-grid">
        <a href="moodboards/moodboards.html" class="app-card" style="--card-accent-color: #FFD300; --card-icon-bg-color-transparent: rgba(255, 211, 0, 0.15);" data-id="moodboards" draggable="true">
          <div class="app-card-icon">üñºÔ∏è</div>
          <h2 class="app-card-title">Moodboard Studio</h2>
          <p class="app-card-description">Create and export beautiful, inspiring moodboards with custom branding, colors, and images.</p>
        </a>
        <a href="blobs/blobs.html" class="app-card" style="--card-accent-color: #800080; --card-icon-bg-color-transparent: rgba(128, 0, 128, 0.15);" data-id="blobs" draggable="true">
            <div class="app-card-icon">üíß</div>
            <h2 class="app-card-title">Blob Studio</h2>
            <p class="app-card-description">Generate smooth, organic, and unique SVG blob shapes. Tweak points, variance, and smoothness.</p>
        </a>
        <a href="jigsaws/jigsaws.html" class="app-card" style="--card-accent-color: #00B5AD; --card-icon-bg-color-transparent: rgba(0, 181, 173, 0.15);" data-id="jigsaws" draggable="true">
          <div class="app-card-icon">üß©</div>
          <h2 class="app-card-title">Jigsaw Generator</h2>
          <p class="app-card-description">Design and export custom vector jigsaw puzzle grids with control over rows, columns, and tab size.</p>
        </a>
        <a href="iconfactory/iconfactory.html" class="app-card" style="--card-accent-color: #3B4352; --card-icon-bg-color-transparent: rgba(59, 67, 82, 0.15);" data-id="iconfactory" draggable="true">
          <div class="app-card-icon">üõ†Ô∏è</div>
          <h2 class="app-card-title">Icon Factory</h2>
          <p class="app-card-description">Combine shapes to create custom icons. Build your collection and download them as a ZIP file.</p>
        </a>
        <a href="qrcodes/qrcodes.html" class="app-card" style="--card-accent-color: #2CA02C; --card-icon-bg-color-transparent: rgba(44, 160, 44, 0.15);" data-id="qrcodes" draggable="true">
            <div class="app-card-icon">üì±</div>
            <h2 class="app-card-title">QR Code Generator</h2>
            <p class="app-card-description">Create custom QR codes for URLs, WiFi, and more. All data is generated locally in your browser.</p>
        </a>
        <a href="palettes/palettes.html" class="app-card" style="--card-accent-color: #FF7F00; --card-icon-bg-color-transparent: rgba(255, 127, 0, 0.15);" data-id="colors" draggable="true">
            <div class="app-card-icon">üåà</div>
            <h2 class="app-card-title">Color Mixer</h2>
            <p class="app-card-description">Generate harmonic color palettes and discover beautiful gradients from a single base color.</p>
        </a>
        <a href="notes/notes.html" class="app-card" style="--card-accent-color: #FF1493; --card-icon-bg-color-transparent: rgba(255, 20, 147, 0.15);" data-id="notes" draggable="true">
            <div class="app-card-icon">üìù</div>
            <h2 class="app-card-title">Notepad & Kanban</h2>
            <p class="app-card-description">Capture ideas, then drag them into your workflow. Your data is saved automatically in the browser.</p>
        </a>
        <a href="locator/locator.html" class="app-card" style="--card-accent-color: #4B0082; --card-icon-bg-color-transparent: rgba(75, 0, 130, 0.15);" data-id="locator" draggable="true">
            <div class="app-card-icon">üìç</div>
            <h2 class="app-card-title">Locator</h2>
            <p class="app-card-description">Geocode a list of locations and visualize the results on an interactive world map. Export as SVG.</p>
        </a>
        <a href="signatures/signatures.html" class="app-card" style="--card-accent-color: #002493; --card-icon-bg-color-transparent: rgba(80, 96, 126, 0.15);" data-id="signatures" draggable="true">
            <div class="app-card-icon">‚úçÔ∏è</div>
            <h2 class="app-card-title">Signature to SVG</h2>
            <p class="app-card-description">Convert image signatures into clean, scalable SVG vector graphics with adjustable settings.</p>
        </a>
        <a href="any2svg/any2svg.html" class="app-card" style="--card-accent-color: #A4C639; --card-icon-bg-color-transparent: rgba(164, 198, 57, 0.15);" data-id="any2svg" draggable="true">
            <div class="app-card-icon">ü™Ñ</div>
            <h2 class="app-card-title">Any2SVG</h2>
            <p class="app-card-description">Convert AI, PSD, PDF, and more to SVG. All files are processed locally in your browser.</p>
        </a>
        <a href="bgremover/bgremover.html" class="app-card" style="--card-accent-color: #E63946; --card-icon-bg-color-transparent: rgba(230, 57, 70, 0.15);" data-id="bgremover" draggable="true">
          <div class="app-card-icon">‚úÇÔ∏è</div>
          <h2 class="app-card-title">Background Remover</h2>
          <p class="app-card-description">Client-side AI cutout. Click, drop or paste an image to automatically remove the background.</p>
        </a>
        <a href="wordclouds/wordclouds.html" class="app-card" style="--card-accent-color: #20B2AA; --card-icon-bg-color-transparent: rgba(32, 178, 170, 0.15);" data-id="wordclouds" draggable="true">
          <div class="app-card-icon">‚òÅÔ∏è</div>
          <h2 class="app-card-title">Word Cloud Generator</h2>
          <p class="app-card-description">Generate beautiful and customizable word clouds from any text source.</p>
        </a>
      </div>
    </main>

    <footer class="site-footer-minimal">
      <button id="feedback-open-btn" class="minimal-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        <span>Feedback</span>
      </button>
      
      <a id="visitor-badge-container" class="minimal-btn" href="https://api.visitorbadge.io" target="_blank" title="Visitor counter">
        </a>
    </footer>
    </div>

  <script>
    const App = {
      el: {},
      THEMES: ['light', 'dark', 'system'],
      THEME_ICONS: { light: '‚òÄÔ∏è', dark: 'üåî', system: '‚öôÔ∏è' },
      DRAG_STATE: { dragged: null, over: null },

      konamiCode: ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'],
      konamiIndex: 0,
      
      init() {
        this.cacheDOMElements();
        this.initTheme();
        this.loadCardOrder();
        this.bindEvents();
        this.initVisitorCounter(); // <-- Llamar al contador de visitas
      },

      cacheDOMElements() {
        this.el.themeToggle = document.getElementById('theme-toggle');
        this.el.appGrid = document.getElementById('app-grid');
        this.el.appCards = Array.from(this.el.appGrid.children);
        
        // === CACHEAR TODOS LOS ELEMENTOS DEL MODAL Y BOTONES ===
        const ids = [
          'feedback-open-btn', 'feedback-overlay', 'feedback-close-btn',
          'feedback-form', 'feedback-type', 'form-status', 'feedback-submit-btn',
          'form-section-feedback', 'form-section-suggest', 'form-section-bug',
          'visitor-badge-container'
        ];
        ids.forEach(id => {
          const key = id.replace(/-(\w)/g, (_, char) => char.toUpperCase());
          const element = document.getElementById(id);
          if (element) this.el[key] = element;
        });
      },

      bindEvents() {
        this.el.themeToggle.addEventListener('click', () => this.cycleTheme());
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
          if (localStorage.getItem('creative-toolkit-theme') === 'system') {
            this.applyTheme('system');
          }
        });

        this.el.appGrid.addEventListener('dragstart', this.handleDragStart.bind(this));
        this.el.appGrid.addEventListener('dragover', this.handleDragOver.bind(this));
        this.el.appGrid.addEventListener('dragleave', this.handleDragLeave.bind(this));
        this.el.appGrid.addEventListener('drop', this.handleDrop.bind(this));
        this.el.appGrid.addEventListener('dragend', this.handleDragEnd.bind(this));

        window.addEventListener('keydown', this.handleKonamiCode.bind(this));
        
        // === BIND EVENTOS DEL MODAL ===
        if(this.el.feedbackOpenBtn) this.el.feedbackOpenBtn.addEventListener('click', () => this.openFeedback());
        if(this.el.feedbackCloseBtn) this.el.feedbackCloseBtn.addEventListener('click', () => this.closeFeedback());
        if(this.el.feedbackOverlay) this.el.feedbackOverlay.addEventListener('click', (e) => {
          if (e.target === this.el.feedbackOverlay) this.closeFeedback();
        });
        if(this.el.feedbackType) this.el.feedbackType.addEventListener('change', () => this.updateFormDisplay());
        if(this.el.feedbackForm) this.el.feedbackForm.addEventListener('submit', (e) => this.handleFormSubmit(e));
      },

      handleKonamiCode(e) {
          if (window.KICKASS_GAME) return;
          if (e.key.toLowerCase() === this.konamiCode[this.konamiIndex].toLowerCase()) {
              this.konamiIndex++;
              if (this.konamiIndex === this.konamiCode.length) {
                  this.activateGame();
                  this.konamiIndex = 0;
              }
          } else {
              this.konamiIndex = 0;
          }
      },
      
      // === C√ìDIGO KONAMI COMPLETO RESTAURADO ===
      activateGame() {
        if (window.KICKASS_GAME) return;

        const KICKASS_GAME = {
            init: function() {
                this.canvas = document.createElement('canvas');
                this.canvas.style.cssText = 'position:fixed; top:0; left:0; z-index:10000; pointer-events:none;';
                document.body.appendChild(this.canvas);
                this.ctx = this.canvas.getContext('2d');
                
                this.score = 0;
                this.lastPowerUpScore = 0;
                this.scoreEl = document.createElement('div');
                this.scoreEl.style.cssText = 'position:fixed; top:10px; left:10px; color:white; font:bold 24px sans-serif; text-shadow:0 0 5px black; z-index:10001;';
                this.statusEl = document.createElement('div');
                this.statusEl.style.cssText = 'position:fixed; top:40px; left:10px; color:lime; font:bold 16px sans-serif; text-shadow:0 0 5px black; z-index:10001;';
                document.body.appendChild(this.scoreEl);
                document.body.appendChild(this.statusEl);

                this.resize();
                
                this.ship = { x: this.width / 2, y: this.height / 2, vx: 0, vy: 0, angle: -Math.PI / 2, rotation: 0, thrust: 0, size: 20 };
                this.bullets = [];
                this.explosions = [];
                this.targets = [];
                this.specialBullet = null; // Can be 'bomb' or 'superbomb'

                this.keys = {};
                this.boundKeyDown = this.handleKeyDown.bind(this);
                this.boundKeyUp = this.handleKeyUp.bind(this);
                this.boundResize = this.resize.bind(this);
                window.addEventListener('keydown', this.boundKeyDown);
                window.addEventListener('keyup', this.boundKeyUp);
                window.addEventListener('resize', this.boundResize);

                this.prepareTargets();
                this.loop();
            },
            
            resize: function() {
                this.width = window.innerWidth;
                this.height = window.innerHeight;
                this.canvas.width = this.width;
                this.canvas.height = this.height;
            },

            prepareTargets: function() {
                const elementsToTarget = document.querySelectorAll('.app-card h2, .app-card p, header.panel h1, header.panel .sub');
                elementsToTarget.forEach(el => {
                    const parentCard = el.closest('.app-card');
                    const text = el.innerText;
                    el.innerHTML = '';
                    text.split(/(\s+)/).forEach(word => {
                        if (word.trim().length > 0) {
                            const span = document.createElement('span');
                            span.className = 'kickass-target';
                            span.textContent = word;
                            el.appendChild(span);
                            this.targets.push({ el: span, parentCard: parentCard, active: true });
                        } else {
                            el.appendChild(document.createTextNode(word));
                        }
                    });
                });
            },

            handleKeyDown: function(e) {
                this.keys[e.code] = true;
                if (e.code === 'Space' || e.code === 'ArrowUp') e.preventDefault();
                if (e.code === 'Space') this.fireBullet();
                if (e.code === 'Escape') this.destroy();
            },
            
            handleKeyUp: function(e) {
                this.keys[e.code] = false;
            },

            fireBullet: function() {
                const bulletType = this.specialBullet || 'normal';
                this.bullets.push({
                    x: this.ship.x + Math.cos(this.ship.angle) * this.ship.size,
                    y: this.ship.y + Math.sin(this.ship.angle) * this.ship.size,
                    vx: Math.cos(this.ship.angle) * 10,
                    vy: Math.sin(this.ship.angle) * 10,
                    life: 80,
                    type: bulletType
                });
                this.specialBullet = null; // Consume the special bullet
            },
            
            createExplosion: function(x, y, radius, color) {
                this.explosions.push({x, y, radius, color, life: 30});
            },

            checkCardStatus: function(card) {
                if (!card) return;
                const remainingTargets = this.targets.some(t => t.parentCard === card && t.active);
                if (!remainingTargets) {
                    card.classList.add('kickass-card-hittable');
                    this.targets.push({ el: card, parentCard: null, active: true, isCard: true });
                }
            },

            update: function() {
                // Ship movement
                if (this.keys['ArrowLeft']) this.ship.angle -= 0.1;
                if (this.keys['ArrowRight']) this.ship.angle += 0.1;

                if (this.keys['ArrowUp']) {
                    this.ship.vx += Math.cos(this.ship.angle) * 0.2;
                    this.ship.vy += Math.sin(this.ship.angle) * 0.2;
                }
                this.ship.vx *= 0.98;
                this.ship.vy *= 0.98;
                this.ship.x += this.ship.vx;
                this.ship.y += this.ship.vy;

                // Screen wrap
                if (this.ship.x < 0) this.ship.x = this.width;
                if (this.ship.x > this.width) this.ship.x = 0;
                if (this.ship.y < 0) this.ship.y = this.height;
                if (this.ship.y > this.height) this.ship.y = 0;

                // Bullets and Collision
                for (let i = this.bullets.length - 1; i >= 0; i--) {
                    const b = this.bullets[i];
                    b.x += b.vx;
                    b.y += b.vy;
                    b.life--;

                    if (b.life <= 0 || b.x < 0 || b.x > this.width || b.y < 0 || b.y > this.height) {
                        this.bullets.splice(i, 1);
                        continue;
                    }

                    for (let j = this.targets.length - 1; j >= 0; j--) {
                        const target = this.targets[j];
                        if (!target.active) continue;
                        
                        const rect = target.el.getBoundingClientRect();
                        if (b.x > rect.left && b.x < rect.right && b.y > rect.top && b.y < rect.bottom) {
                            
                            if (b.type === 'normal') {
                                target.el.classList.add('kickass-destroyed');
                                target.active = false;
                                this.score++;
                                this.checkCardStatus(target.parentCard);
                            } else if (b.type === 'bomb' || b.type === 'superbomb') {
                                const radius = b.type === 'bomb' ? 75 : 150;
                                const color = b.type === 'bomb' ? 'orange' : 'red';
                                this.createExplosion(b.x, b.y, radius, color);
                                this.targets.forEach(t => {
                                    if (t.active) {
                                        const tRect = t.el.getBoundingClientRect();
                                        const tCenterX = tRect.left + tRect.width / 2;
                                        const tCenterY = tRect.top + tRect.height / 2;
                                        const dist = Math.sqrt(Math.pow(tCenterX - b.x, 2) + Math.pow(tCenterY - b.y, 2));
                                        if (dist < radius) {
                                            t.el.classList.add('kickass-destroyed');
                                            t.active = false;
                                            this.score++;
                                            this.checkCardStatus(t.parentCard);
                                        }
                                    }
                                });
                            }
                            
                            this.bullets.splice(i, 1);
                            break; 
                        }
                    }
                }
                
                // Explosions
                for (let i = this.explosions.length - 1; i >= 0; i--) {
                    const exp = this.explosions[i];
                    exp.life--;
                    if (exp.life <= 0) {
                        this.explosions.splice(i, 1);
                    }
                }

                // Score and Power-ups
                if (Math.floor(this.score / 100) > Math.floor(this.lastPowerUpScore / 100)) {
                    this.specialBullet = 'superbomb';
                } else if (Math.floor(this.score / 10) > Math.floor(this.lastPowerUpScore / 10)) {
                    this.specialBullet = 'bomb';
                }
                this.lastPowerUpScore = this.score;

                this.scoreEl.innerHTML = this.score + " DESTROYED";
                if(this.specialBullet === 'superbomb') {
                    this.statusEl.innerHTML = 'MEGA BOMB LOADED!';
                    this.statusEl.style.color = 'red';
                } else if (this.specialBullet === 'bomb') {
                    this.statusEl.innerHTML = 'BOMB LOADED';
                    this.statusEl.style.color = 'orange';
                } else {
                    this.statusEl.innerHTML = '';
                }
            },

            draw: function() {
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                // Ship
                this.ctx.save();
                this.ctx.translate(this.ship.x, this.ship.y);
                this.ctx.rotate(this.ship.angle + Math.PI / 2);
                this.ctx.beginPath();
                this.ctx.moveTo(0, -this.ship.size / 2);
                this.ctx.lineTo(this.ship.size / 2, this.ship.size / 2);
                this.ctx.lineTo(-this.ship.size / 2, this.ship.size / 2);
                this.ctx.closePath();
                this.ctx.fillStyle = 'white';
                this.ctx.strokeStyle = '#4f46e5';
                this.ctx.lineWidth = 2;
                this.ctx.fill();
                this.ctx.stroke();
                this.ctx.restore();
                
                // Bullets
                for (let i = 0; i < this.bullets.length; i++) {
                    const b = this.bullets[i];
                    if(b.type === 'normal') this.ctx.fillStyle = 'lime';
                    if(b.type === 'bomb') this.ctx.fillStyle = 'orange';
                    if(b.type === 'superbomb') this.ctx.fillStyle = 'red';
                    this.ctx.beginPath();
                    this.ctx.arc(b.x, b.y, b.type === 'normal' ? 3 : 6, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                
                // Explosions
                for (const exp of this.explosions) {
                    this.ctx.beginPath();
                    this.ctx.arc(exp.x, exp.y, exp.radius * (1 - exp.life / 30), 0, Math.PI * 2);
                    this.ctx.fillStyle = `rgba(255, 255, 255, ${exp.life / 30})`;
                    this.ctx.fill();
                    this.ctx.strokeStyle = `${exp.color}`;
                    this.ctx.lineWidth = 3;
                    this.ctx.stroke();
                }
            },

            loop: function() {
                this.update();
                this.draw();
                this.raf = requestAnimationFrame(this.loop.bind(this));
            },
            
            destroy: function() {
                window.removeEventListener('keydown', this.boundKeyDown);
                window.removeEventListener('keyup', this.boundKeyUp);
                window.removeEventListener('resize', this.boundResize);
                cancelAnimationFrame(this.raf);
                if (this.canvas.parentNode) document.body.removeChild(this.canvas);
                if (this.scoreEl.parentNode) document.body.removeChild(this.scoreEl);
                if (this.statusEl.parentNode) document.body.removeChild(this.statusEl);
                
                document.querySelectorAll('.kickass-target').forEach(span => {
                    if (span.parentNode) {
                        const parent = span.parentNode;
                        parent.replaceChild(document.createTextNode(span.textContent), span);
                        parent.normalize();
                    }
                });
                document.querySelectorAll('.kickass-card-hittable').forEach(card => card.classList.remove('kickass-card-hittable'));
                
                window.KICKASS_GAME = null;
            }
        };
        window.KICKASS_GAME = KICKASS_GAME;
        KICKASS_GAME.init();
      },
      // === FIN C√ìDIGO KONAMI ===

      initTheme() {
        const savedTheme = localStorage.getItem('creative-toolkit-theme') || 'system';
        this.setTheme(savedTheme, false);
      },

      setTheme(theme, save = true) {
        if (save) {
          localStorage.setItem('creative-toolkit-theme', theme);
        }
        this.el.themeToggle.textContent = this.THEME_ICONS[theme];
        this.applyTheme(theme);
      },

      cycleTheme() {
        const currentTheme = localStorage.getItem('creative-toolkit-theme') || 'system';
        const currentIndex = this.THEMES.indexOf(currentTheme);
        const nextTheme = this.THEMES[(currentIndex + 1) % this.THEMES.length];
        this.setTheme(nextTheme);
      },

      applyTheme(theme) {
        const isDark = (theme === 'system')
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : theme === 'dark';
        document.documentElement.dataset.theme = isDark ? 'dark' : 'light';
      },

      handleDragStart(e) {
        const targetCard = e.target.closest('.app-card');
        if (targetCard) {
          this.DRAG_STATE.dragged = targetCard;
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/plain', targetCard.dataset.id);
          setTimeout(() => targetCard.classList.add('dragging'), 0);
        }
      },

      handleDragOver(e) {
        e.preventDefault();
        const targetCard = e.target.closest('.app-card');
        if (targetCard && targetCard !== this.DRAG_STATE.dragged) {
          this.DRAG_STATE.over = targetCard;
          
          const bounding = targetCard.getBoundingClientRect();
          const offset = bounding.y + bounding.height / 2;
          
          if (e.clientY - offset > 0) {
            targetCard.parentNode.insertBefore(this.DRAG_STATE.dragged, targetCard.nextSibling);
          } else {
            targetCard.parentNode.insertBefore(this.DRAG_STATE.dragged, targetCard);
          }
        }
      },

      handleDragLeave(e) { /* Can be empty for this logic */ },

      handleDrop(e) {
        e.preventDefault();
      },

      handleDragEnd(e) {
        if (this.DRAG_STATE.dragged) {
          this.DRAG_STATE.dragged.classList.remove('dragging');
        }
        this.DRAG_STATE.dragged = null;
        this.saveCardOrder();
      },

      saveCardOrder() {
        const order = Array.from(this.el.appGrid.children).map(card => card.dataset.id);
        localStorage.setItem('appCardOrder', JSON.stringify(order));
      },

      loadCardOrder() {
        const savedOrder = localStorage.getItem('appCardOrder');
        if (savedOrder) {
          const order = JSON.parse(savedOrder);
          const currentCards = Array.from(this.el.appGrid.children);
          const cardMap = new Map(currentCards.map(card => [card.dataset.id, card]));

          const fragment = document.createDocumentFragment();
          order.forEach(id => {
            if (cardMap.has(id)) {
              fragment.appendChild(cardMap.get(id));
              cardMap.delete(id);
            }
          });
          cardMap.forEach(card => fragment.appendChild(card));

          this.el.appGrid.innerHTML = '';
          this.el.appGrid.appendChild(fragment);
        }
      },
      
      // === INICIO DE NUEVAS FUNCIONES ===
      
      // -- Contador de Visitas --
      initVisitorCounter() {
        if (!this.el.visitorBadgeContainer) return;

        const title = document.title;
        const pagePath = title.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/--+/g, '-');
        const fullPath = `ealfaro29.toolkit.${pagePath}`;

        let accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim().substring(1);
        if (!accentColor || accentColor.length < 6) {
          accentColor = '4f46e5'; // Fallback
        }
        
        const badgeUrl = `https://api.visitorbadge.io/api/visitors?path=${fullPath}&label=Visitors&labelColor=%23555555&countColor=%23${accentColor}`;
        const linkUrl = `https://api.visitorbadge.io/api/visitors?path=${fullPath}`;

        this.el.visitorBadgeContainer.href = linkUrl;
        this.el.visitorBadgeContainer.innerHTML = `<img src="${badgeUrl}" alt="Visitor counter" />`;
      },

      // -- L√≥gica del Modal de Feedback --
      openFeedback() {
        if(this.el.feedbackOverlay) this.el.feedbackOverlay.classList.add('show');
      },
      
      closeFeedback() {
        if(this.el.feedbackOverlay) this.el.feedbackOverlay.classList.remove('show');
        if(this.el.feedbackForm) this.el.feedbackForm.reset();
        this.updateFormDisplay();
        this.setFormStatus(null);
      },
      
      updateFormDisplay() {
        const type = this.el.feedbackType.value;
        
        if(this.el.formSectionFeedback) this.el.formSectionFeedback.style.display = 'none';
        if(this.el.formSectionSuggest) this.el.formSectionSuggest.style.display = 'none';
        if(this.el.formSectionBug) this.el.formSectionBug.style.display = 'none';
        
        this.el.feedbackForm.querySelectorAll('.form-section [required]').forEach(el => el.required = false);
        
        switch(type) {
          case 'feedback':
            if(this.el.formSectionFeedback) this.el.formSectionFeedback.style.display = 'flex';
            break;
          case 'suggest':
            if(this.el.formSectionSuggest) this.el.formSectionSuggest.style.display = 'flex';
            break;
          case 'bug':
            if(this.el.formSectionBug) this.el.formSectionBug.style.display = 'flex';
            if(this.el.formSectionBug.querySelector('[name="bug_behavior"]')) {
              this.el.formSectionBug.querySelector('[name="bug_behavior"]').required = true;
            }
            break;
        }
      },
      
      setFormStatus(status, message) {
        if (!this.el.formStatus) return;
        
        this.el.formStatus.style.display = status ? 'block' : 'none';
        this.el.formStatus.className = ``;
        
        if (status) {
          this.el.formStatus.classList.add(status); // 'sending', 'success', 'error'
          this.el.formStatus.textContent = message;
        }
      },
      
      async handleFormSubmit(event) {
        event.preventDefault();
        const form = this.el.feedbackForm;
        const submitButton = this.el.feedbackSubmitBtn;
        const data = new FormData(form);

        this.setFormStatus('sending', 'Sending...');
        submitButton.disabled = true;

        try {
          const response = await fetch(form.action, {
            method: form.method,
            body: data,
            headers: {
              'Accept': 'application/json'
            }
          });

          if (response.ok) {
            this.setFormStatus('success', 'Thank you! Your message has been sent.');
            form.reset();
            this.updateFormDisplay();
            setTimeout(() => {
              this.closeFeedback();
            }, 2500);
          } else {
            const responseData = await response.json();
            if (responseData.errors) {
              const errorMsg = responseData.errors.map(err => err.message).join(', ');
              this.setFormStatus('error', `Error: ${errorMsg}`);
            } else {
              this.setFormStatus('error', 'Error submitting the form.');
            }
          }
        } catch (error) {
          this.setFormStatus('error', 'Network error. Please try again.');
        } finally {
          submitButton.disabled = false;
        }
      }
      // === FIN DE NUEVAS FUNCIONES ===
    };

    document.addEventListener('DOMContentLoaded', () => App.init());
  </script>

  <div id="feedback-overlay" class="popup-overlay">
    <div class="feedback-modal-content panel">
      <div class="feedback-header">
        <h3>Submit Feedback</h3>
        <button id="feedback-close-btn" title="Close">&times;</button>
      </div>
      
      <form id="feedback-form" action="https://formspree.io/f/xanldeve" method="POST">
        
        <div id="form-status"></div>

        <div class="form-group">
          <label for="feedback-type">Message Type</label>
          <div class="select-wrapper">
            <select id="feedback-type" name="submission_type" class="form-control" required>
              <option value="" disabled selected>Choose an option...</option>
              <option value="feedback">General Feedback</option>
              <option value="suggest">Suggest an App</option>
              <option value="bug">Report a Bug</option>
            </select>
          </div>
        </div>

        <div id="form-section-feedback" class="form-section">
          <div class="form-group">
            <label>Rating</label>
            <div class="star-rating">
              <input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="5 stars">‚òÖ</label>
              <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 stars">‚òÖ</label>
              <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 stars">‚òÖ</label>
              <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 stars">‚òÖ</label>
              <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1 star">‚òÖ</label>
            </div>
          </div>
          <div class="form-group">
            <label for="feedback-comment">Comments</label>
            <textarea id="feedback-comment" name="comment" class="form-control" rows="4" placeholder="What do you like or what could we improve?"></textarea>
          </div>
        </div>

        <div id="form-section-suggest" class="form-section">
          <div class="form-group">
            <label for="suggest-task">Task to Solve</label>
            <input type="text" id="suggest-task" name="suggest_task" class="form-control" placeholder="e.g., 'Convert audio to text'">
          </div>
          <div class="form-group">
            <label for="suggest-comment">Additional Comments</label>
            <textarea id="suggest-comment" name="suggest_comment" class="form-control" rows="4" placeholder="Describe your idea a bit more..."></textarea>
          </div>
          <div class="form-group">
            <label for="suggest-name">App Name (Optional)</label>
            <input type="text" id="suggest-name" name="suggest_name" class="form-control" placeholder="e.g., 'Audio Transcriber'">
          </div>
        </div>

        <div id="form-section-bug" class="form-section">
          <div class="form-group">
            <label for="bug-app">Which app has the bug?</label>
            <div class="select-wrapper">
              <select id="bug-app" name="bug_app" class="form-control">
                <option value="General">General (Main Website)</option>
                <option value="Moodboard Studio">Moodboard Studio</option>
                <option value="Blob Studio">Blob Studio</option>
                <option value="Jigsaw Generator">Jigsaw Generator</option>
                <option value="Icon Factory">Icon Factory</option>
                <option value="QR Code Generator">QR Code Generator</option>
                <option value="Color Mixer">Color Mixer</option>
                <option value="Notepad & Kanban">Notepad & Kanban</option>
                <option value="Locator">Locator</option>
                <option value="Signature to SVG">Signature to SVG</option>
                <option value="Any2SVG">Any2SVG</option>
                <option value="Background Remover">Background Remover</option>
                <option value="Word Cloud Generator">Word Cloud Generator</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="bug-behavior">Bug Behavior</label>
            <textarea id="bug-behavior" name="bug_behavior" class="form-control" rows="5" placeholder="What were you doing? What did you expect to happen? What actually happened?" required></textarea>
          </div>
        </div>
        
        <div class_group" style="border-top: 1px solid var(--border-color); padding-top: var(--space-4);">
          <label for="user-email">Your Name (Optional)</label>
          <input type="email" id="user-email" name="email" class="form-control" placeholder="So we can get back to you...">
        </div>

        <button type="submit" class="btn btn-primary" id="feedback-submit-btn">Send Feedback</button>
      </form>
    </div>
  </div>
  </body>
</html>